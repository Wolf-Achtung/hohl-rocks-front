<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="dark" />
    <meta name="x-api-base" content="/api"/>
    <title>hohl.rocks – KI-gestützte Web-Experience</title>
    <meta name="description" content="Erleben Sie die Kraft der KI: Neon-Bubbles mit intelligenten Assistenten für Ihren Arbeitsalltag." />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css" />
    <style>
      /* Bubble-spezifische Styles */
      #bubbles {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 5;
      }
      
      .bubble {
        position: absolute;
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        cursor: pointer;
        pointer-events: auto;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 1rem;
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.9);
        animation: float 6s ease-in-out infinite;
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
      }
      
      .bubble:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.4);
        transform: scale(1.1);
        box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
      }
      
      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-20px); }
      }
      
      /* Bubble-Modal für KI-Antworten */
      #bubble-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(10px);
        z-index: 2000;
      }
      
      #bubble-modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(20, 20, 30, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 16px;
        padding: 2rem;
        max-width: 700px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        color: #fff;
      }
      
      #bubble-modal-close {
        float: right;
        background: transparent;
        border: none;
        color: #fff;
        font-size: 2rem;
        cursor: pointer;
        line-height: 1;
        padding: 0;
        margin: -10px -10px 0 0;
        transition: transform 0.2s;
      }
      
      #bubble-modal-close:hover {
        transform: scale(1.2);
      }
      
      .be-stream {
        padding: 1rem 0;
        color: rgba(255, 255, 255, 0.95);
        line-height: 1.8;
        font-size: 1rem;
      }
      
      .be-stream strong {
        color: #4fc3f7;
        font-weight: 600;
      }
      
      .be-stream em {
        color: #81c784;
        font-style: normal;
      }
      
      .loading-dots {
        display: inline-block;
      }
      
      .loading-dots::after {
        content: '...';
        animation: dots 1.5s steps(4, end) infinite;
      }
      
      @keyframes dots {
        0%, 20% { content: '.'; }
        40% { content: '..'; }
        60%, 100% { content: '...'; }
      }
    </style>
  </head>
  <body>
    <video class="bg" autoplay muted loop playsinline aria-hidden="true" poster="./videos/road_poster.jpg">
      <source src="./videos/road_720p_bg.webm" type="video/webm" />
      <source src="./videos/road_720p_bg.mp4" type="video/mp4" />
    </video>

    <!-- KI-Bubbles Container -->
    <div id="bubbles" aria-hidden="false">
      <div class="bubble" data-bubble="briefing" style="width: 140px; height: 140px; top: 20%; left: 10%; animation-delay: 0s;">
        Briefing-Assistent
      </div>
      <div class="bubble" data-bubble="agenda" style="width: 130px; height: 130px; top: 25%; right: 15%; animation-delay: 1s;">
        Meeting-Agenda
      </div>
      <div class="bubble" data-bubble="pitch" style="width: 120px; height: 120px; top: 50%; left: 8%; animation-delay: 2s;">
        60s Pitch
      </div>
      <div class="bubble" data-bubble="risks" style="width: 135px; height: 135px; top: 55%; right: 12%; animation-delay: 3s;">
        Risiko-Analyse
      </div>
      <div class="bubble" data-bubble="excel" style="width: 125px; height: 125px; top: 75%; left: 15%; animation-delay: 4s;">
        Excel-Formeln
      </div>
      <div class="bubble" data-bubble="daily" style="width: 140px; height: 140px; top: 70%; right: 20%; animation-delay: 5s;">
        Täglicher Fokus
      </div>
    </div>
    
    <ul id="bubble-labels" aria-hidden="true"></ul>

    <!-- KI-Modal für Bubble-Antworten -->
    <div id="bubble-modal">
      <div id="bubble-modal-content">
        <button id="bubble-modal-close" aria-label="Schließen" title="Schließen (ESC)">×</button>
        <div class="be-stream"></div>
      </div>
    </div>

    <header class="site-header">
      <nav class="site-nav" aria-label="Hauptnavigation">
        <button class="nav-btn" data-action="tips" type="button">KI-Tipps</button>
        <button class="nav-btn" data-action="news" type="button">KI-News</button>
        <button class="nav-btn" data-action="prompts" type="button">Prompts</button>
        <button class="nav-btn" data-action="projekte" type="button">Projekte</button>
        <button class="nav-btn" data-action="impressum" type="button">Impressum</button>
        <button class="nav-btn toggle" id="btn-eu" type="button" aria-pressed="false" title="EU-only Provider">EU: aus</button>
        <button class="nav-btn" data-action="klang" type="button">Klang</button>
        <button class="nav-btn gear" data-action="settings" aria-label="Einstellungen" title="Einstellungen (S)" type="button">⚙︎</button>
      </nav>
    </header>

    <main class="hero" role="main" id="main"><h1>hohl.rocks</h1></main>

    <!-- Overlays bleiben gleich -->
    <div id="ov-tips" class="overlay" aria-hidden="true">
      <div class="backdrop" data-close="1"></div>
      <div class="panel" role="dialog" aria-modal="true" aria-labelledby="ov-tips-title">
        <header><h2 id="ov-tips-title">KI-Tipps</h2><button class="close" data-close="1" aria-label="Schließen">Schließen ✕</button></header>
        <div class="tags"><span class="tag" id="tag-tips">Tipps …</span></div>
        <div class="small">Fokus: How-to · Praxis · Prompting · Produktivität (DE/DACH)</div>
        <div class="grid-tips" id="tips-grid"></div>
      </div>
    </div>

    <div id="ov-news" class="overlay" aria-hidden="true">
      <div class="backdrop" data-close="1"></div>
      <div class="panel" role="dialog" aria-modal="true" aria-labelledby="ov-news-title">
        <header><h2 id="ov-news-title">KI-News</h2><button class="close" data-close="1" aria-label="Schließen">Schließen ✕</button></header>
        <div class="tags"><span class="tag" id="tag-api">API …</span><span class="tag" id="tag-news">News …</span></div>
        <div class="small">DE-Fokus: Regulierung · Releases · Sicherheit · Wirtschaft</div>
        <ul class="list" id="news"></ul>
      </div>
    </div>

    <div id="ov-prompts" class="overlay" aria-hidden="true">
      <div class="backdrop" data-close="1"></div>
      <div class="panel" role="dialog" aria-modal="true" aria-labelledby="ov-prompts-title">
        <header><h2 id="ov-prompts-title">Prompt-Galerie</h2><button class="close" data-close="1" aria-label="Schließen">Schließen ✕</button></header>
        <div class="tools">
          <input type="search" id="prompt-search" placeholder="Suchen…" aria-label="Prompts durchsuchen"/>
          <button class="chip" data-filter="Alle" data-active="1">Alle</button>
          <button class="chip" data-filter="Alltag">Alltag</button>
          <button class="chip" data-filter="Arbeit">Arbeit</button>
          <button class="chip" data-filter="Kreativ">Kreativ</button>
        </div>
        <div class="grid-prompts" id="prompt-grid"></div>
      </div>
    </div>

    <div id="ov-impressum" class="overlay" aria-hidden="true">
      <div class="backdrop" data-close="1"></div>
      <div class="panel" role="dialog" aria-modal="true" aria-labelledby="ov-impressum-title">
        <header><h2 id="ov-impressum-title">Rechtliches &amp; Transparenz</h2><button class="close" data-close="1" aria-label="Schließen">Schließen ✕</button></header>
        <div class="small" id="impressum-body"></div>
      </div>
    </div>

    <div id="ov-run" class="overlay" aria-hidden="true">
      <div class="backdrop" data-close="1"></div>
      <div class="panel" role="dialog" aria-modal="true" aria-labelledby="ov-run-title">
        <header><h2 id="ov-run-title">Run</h2><button class="close" data-close="1" aria-label="Schließen">Schließen ✕</button></header>
        <div class="small">Streamt live von /api/run/stream</div>
        <form id="run-form"><textarea id="run-input" rows="4" style="width:100%;margin:8px 0" placeholder="Frag mich etwas …"></textarea><button type="submit">Absenden</button></form>
        <pre id="run-out" style="white-space:pre-wrap"></pre>
      </div>
    </div>

    <section id="modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Overlay">
      <div class="modal__panel" tabindex="-1">
        <div class="modal__toolbar"><button class="ui btn" data-copy="modal" type="button">Kopieren</button><button class="ui btn ghost modal__close" aria-label="Schließen" type="button">Schließen</button></div>
        <div id="modal-content"></div>
      </div>
    </section>

    <section id="tour" class="tour" aria-hidden="true" aria-label="Onboarding">
      <div class="tour__panel" role="dialog" aria-modal="true" tabindex="-1">
        <ol>
          <li><strong>KI-Bubbles</strong>: Klicke eine Bubble – erlebe echte KI-Intelligenz in Aktion.</li>
          <li><strong>Shortcuts</strong>: <kbd>T</kbd> Tipps · <kbd>N</kbd> News · <kbd>P</kbd> Prompts.</li>
          <li><strong>Layout</strong>: Drücke <kbd>O</kbd> für Orbit-Layout.</li>
        </ol>
        <div class="tour__actions"><button class="ui btn" data-tour="done" type="button">Verstanden</button><button class="ui btn ghost" data-tour="skip" type="button">Überspringen</button></div>
      </div>
    </section>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>

    <!-- KI-Bubble Interaktions-Script -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      const modal = document.getElementById('bubble-modal');
      const closeBtn = document.getElementById('bubble-modal-close');
      const streamBox = document.querySelector('.be-stream');
      
      // Modal schließen
      function closeModal() {
        modal.style.display = 'none';
      }
      
      closeBtn?.addEventListener('click', closeModal);
      
      modal?.addEventListener('click', function(e) {
        if (e.target === modal) closeModal();
      });
      
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.style.display === 'block') {
          closeModal();
        }
      });
      
      // Bubble Click Handler mit KI-Integration
      document.querySelectorAll('.bubble').forEach(bubble => {
        bubble.addEventListener('click', async function() {
          const bubbleId = this.dataset.bubble;
          const bubbleText = this.textContent;
          
          // Modal öffnen
          modal.style.display = 'block';
          streamBox.innerHTML = `
            <div style="text-align: center; padding: 2rem;">
              <div style="font-size: 1.2rem; margin-bottom: 1rem;">
                🤖 KI-${bubbleText} wird aktiviert
              </div>
              <div class="loading-dots" style="color: #4fc3f7; font-size: 1.5rem"></div>
            </div>
          `;
          
          // Optional: Kontext vom User abfragen
          let userContext = '';
          if (bubbleId === 'briefing' || bubbleId === 'pitch') {
            userContext = prompt(`Für welches Thema möchten Sie ${bubbleText === 'Briefing-Assistent' ? 'ein Briefing' : 'einen Pitch'}? (Enter für Beispiel)`) || '';
          } else if (bubbleId === 'excel') {
            userContext = prompt('Beschreiben Sie Ihr Excel-Problem:') || '';
          } else if (bubbleId === 'daily') {
            userContext = prompt('Was ist Ihr Fokus heute? (z.B. "3 Deadlines diese Woche")') || '';
          }
          
          try {
            // KI-API aufrufen
            const response = await fetch('/api/run', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                input: `[Bubble ${bubbleId}]`,
                payload: {
                  context: userContext,
                  topic: userContext,
                  problem: userContext
                }
              })
            });
            
            const data = await response.json();
            
            if (data.result) {
              // Formatiere die KI-Antwort schön
              let formatted = data.result
                .replace(/\*\*(.*?)\*\*/g, '<strong style="color: #4fc3f7;">$1</strong>')
                .replace(/\*(.*?)\*/g, '<em style="color: #81c784;">$1</em>')
                .replace(/^- /gm, '• ')
                .replace(/^(\d+)\. /gm, '<strong>$1.</strong> ')
                .replace(/\n\n/g, '</p><p style="margin: 1rem 0;">')
                .replace(/\n/g, '<br>');
              
              streamBox.innerHTML = `
                <div style="animation: fadeIn 0.5s;">
                  <p style="margin: 1rem 0;">${formatted}</p>
                  <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1); opacity: 0.7; font-size: 0.85rem;">
                    🤖 Generiert mit: ${data.model} | ${new Date().toLocaleTimeString('de-DE')}
                    ${userContext ? ` | Kontext: "${userContext.substring(0, 30)}..."` : ''}
                  </div>
                </div>
              `;
            } else {
              throw new Error('Keine Antwort erhalten');
            }
          } catch (error) {
            console.error('KI-Fehler:', error);
            streamBox.innerHTML = `
              <div style="text-align: center; padding: 2rem;">
                <div style="color: #ffd54f; font-size: 1.2rem; margin-bottom: 1rem;">
                  ⚡ Demo-Modus
                </div>
                <p style="opacity: 0.9;">
                  Die KI-Integration generiert normalerweise hier beeindruckende, 
                  personalisierte Antworten basierend auf modernster KI-Technologie.
                </p>
                <p style="margin-top: 1rem; opacity: 0.7; font-size: 0.9rem;">
                  Mit aktivierten API-Keys erleben Sie die volle Power von Claude, GPT-4 und Perplexity!
                </p>
              </div>
            `;
          }
        });
      });
    });
    </script>

    <!-- Module laden -->
    <script type="module" src="./js/utils.js"></script>
    <script type="module" src="./js/api.js"></script>
    <script type="module" src="./js/app.js"></script>
    <script type="module" src="./js/audio.js"></script>
    <script type="module" src="./js/bubbleEngine.js"></script>
    <script type="module" src="./js/overlay.js"></script>
    <script type="module" src="./js/modal.js"></script>
  </body>
</html>